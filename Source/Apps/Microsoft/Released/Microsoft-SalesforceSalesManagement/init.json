{
  "Install": {
    "Pages": [
      {
        "name": "$SiteCommon$/pagesgallery/getting-started.html",
        "templateName": "Salesforce Sales Management",
        "subtitle": "Welcome to the Salesforce Sales Management solution template.",
        "displayname": "Getting Started",
        "architectureDiagram": "dist/Apps/Microsoft/Released/Microsoft-SalesforceSalesManagement/Web/Images/salesforceArchitectureDiagram.png",
        "list1": [
          "Azure Subscription",
          "Salesforce Subscription",
          "Azure SQL Database",
          "Power BI Desktop (latest version)",
          "Power BI Pro (to share the template with your organization)"
        ],
        "list2": [
          "Full cloud solution with minimum set up and maintenance considerations",
          "Data pulled from Salesforce into an Azure SQL Database using Azure Data Factory",
          "Connect to Azure SQL and import data into Power BI"
        ]
      },
      {
        "name": "$SiteCommon$/pagesgallery/azure-login.html",
        "displayname": "Azure",
        "pricingCost": "$run('By clicking next and deploying the template, you authorize Microsoft to create Azure resources on your subscription and bill based on their respective pricing rates. The approximate base cost of the Azure resources used by this template is $1.50 a day. The cost will vary with the amount of data that will be moved. These costs are estimates only and subject to change.')",
        "pricingCalculatorUrl": "https://azure.microsoft.com/en-us/pricing/calculator/",
        "pricingUrl": "https://github.com/Microsoft/BusinessPlatformApps/tree/master/Source/Apps/Microsoft/Released/Microsoft-SalesforceSalesManagement#azure-data-factory-pricing"
      },
      {
        "name": "$SiteCommon$/pagesgallery/salesforce-login.html",
        "displayname": "Salesforce",
        "salesforceObjects": "Opportunity,Account,Lead,Product2,OpportunityLineItem,OpportunityStage,User,UserRole"
      },
      {
        "name": "$SiteCommon$/pagesgallery/sql-server.html",
        "displayname": "Target",
        "isAzureSql": true,
        "showAzureSql": false,
        "showNewSqlOption": true,
        "subtitle": "Set up a connection to SQL so we can bring in your Salesforce data.",
        "title": "Connect to your SQL Database",
        "newSqlDatabase": "SalesforceDB",
        "showGovAzure": true
      },

      // Adding azure pages
      {
        "name": "$SiteCommon$/pagesgallery/choose-analysis-server.html",
        "displayname": "AAS",
        "showDescription": true,
        "skip": "$ds(ssasDisabled)"
      },

      {
        "name": "$SiteCommon$/pagesgallery/ssas.html",
        "displayname": "AAS Login",
        "skip": "$ds(ssasDisabled)"
      },
      // end azure pages

      {
        "name": "$SiteCommon$/pagesgallery/customize.html",
        "displayname": "Customize",
        "showEmails": true,
        "showRecurrenceOptions": true,
        "sourceApplication": "Salesforce"
      },
      {
        "name": "$SiteCommon$/pagesgallery/summary.html",
        "displayname": "Summary",
        "values": {
          "Subscription": "$(this.MS.DataStore.getJson(\"SelectedSubscription\").SubscriptionId)",
          "ResourceGroup": "$(this.MS.DataStore.getValue(\"SelectedResourceGroup\"))",
          "SqlServer": "$(this.MS.DataStore.getJson(\"SqlCredentials\").Server)",
          "Database": "$(this.MS.DataStore.getJson(\"SqlCredentials\").Database)",
          "FiscalStart": "$(this.MS.DataStore.getValue(\"fiscalMonth\"))",
          "Emails": "$(this.MS.DataStore.getValue(\"EmailAddresses\"))",
          "Actuals": "$(this.MS.DataStore.getValue(\"actuals\"))",
          "PipelineFrequency": "$(this.MS.DataStore.getValue(\"postDeploymentPipelineFrequency\"))",
          "PipelineInterval": "$(this.MS.DataStore.getValue(\"postDeploymentPipelineInterval\"))"
        }
      },
      {
        "name": "$SiteCommon$/pagesgallery/progress.html",
        "displayname": "Progress",
        "finishedActionName": "Microsoft-ADFSliceStatus",
        "targetSchema": "dbo",
        "filename": "$save('SalesManagementReport.pbix')",
        "showCounts": true,
        "asDatabase": "salesforce",
        "filenameSSAS": "SalesManagementReportAS.pbix",
        "uniqueId": "$save(this.MS.UtilityService.GetUniqueId(10))"
      }
    ],
    "Actions": [
      {
        "name": "Microsoft-DeploySQLScripts",
        "displayname": "Deploying database scripts",
        "SqlServerIndex": "0",
        "SqlScriptsFolder": "Service/Database"
      },
      {
        "name": "Microsoft-SalesforceGetObjectMetadata",
        "displayname": "Retrieving metadata from Salesforce"
      },
      {
        "name": "Microsoft-SalesforceSqlArtefacts",
        "displayname": "Creating tables in database"
      },
      {
        "name": "Microsoft-SetConfigValueInSql",
        "displayname": "Setting configuration",
        "SqlServerIndex": "0",
        "SqlConfigTable": "[smgt].[configuration]"
      },

      // AS Set up
      {
        "name": "Microsoft-DeployAzureASModel",
        "displayname": "Deploy AS Model",
        "xmlaFilePath": "Service/AzureAS/SalesManagement.xmla",
        "SqlConnectionString": "$dsall(SqlConnectionString)[0]",
        "ASDatabase": "salesforce",
        "skip": "$ds(ssasDisabled)"
      },

      {
        "name": "Microsoft-DeployAzureFunction",
        "displayname": "Deploying scheduler",
        "DeploymentName": "ASFunction",
        "FunctionName": "$save('asscheduler' + this.MS.DataStore.getValue('uniqueId'))",
        "RepoUrl": "https://github.com/MohaaliMicrosoft/AnalysisServicesRefresh",
        "sku": "Standard",
        "skip": "$ds(ssasDisabled)"
      },

      {
        "name": "Microsoft-WaitForArmDeploymentStatus",
        "displayname": "Waiting for scheduler",
        "DeploymentName": "ASFunction",
        "skip": "$ds(ssasDisabled)"
      },

      {
        "name": "Microsoft-DeployAzureFunctionConnectionStrings",
        "displayname": "Setting up scheduler",
        "DeploymentName": "ASFunction",
        "skip": "$ds(ssasDisabled)",
        "AppSettingKeys": {
          "connStringAS": "$ds(ASConnectionString)",
          "connStringSql": "$dsall(SqlConnectionString)[0]",
          "schema": "[smgt]",
          "databaseAS": "salesforce"
        }
      },
      // AS Finish set up

      {
        "name": "Microsoft-ADFDeployLinkedServices",
        "displayname": "Creating data connections",
        "DeploymentName": "ADFDeployment"
      },
      {
        "name": "Microsoft-ADFDeployDatasets",
        "displayname": "Creating mappings to historical data",
        "DeploymentName": "ADFPreDeploymentDatasets"
      },
      {
        "name": "Microsoft-ADFDeployPipelines",
        "displayname": "Scheduling one time data load for historical data",
        "DeploymentName": "ADFPreDeploymentPipeline"
      },
      {
        "name": "Microsoft-ADFDeployDatasets",
        "displayname": "Creating mappings to future data",
        "DeploymentName": "ADFPostDeploymentDatasets",
        "postDeploymentPipelineType": "PostDeployment"
      },
      {
        "name": "Microsoft-ADFDeployPipelines",
        "displayname": "Scheduling data loads for future data ",
        "DeploymentName": "ADFPostDeploymentPipeline",
        "postDeploymentPipelineType": "PostDeployment"
      },
      {
        "name": "Microsoft-GetDataPullStatus",
        "displayname": "Checking data exists in target",
        "SqlServerIndex": 0,
        "TargetSchema": "dbo",
        "IsWaiting": true,
        "FinishedActionName": "Microsoft-ADFSliceStatus"
      }
    ]
  },
  "Uninstall": {
    "Pages": [
      {
        "name": "$SiteCommon$/pagesgallery/getting-started.html",
        "displayname": "Uninstall Start"
      },
      {
        "name": "$SiteCommon$/pagesgallery/azure-login.html",
        "displayname": " Uninstall Login"
      }
    ],
    "Actions": []
  }
}